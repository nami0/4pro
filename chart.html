<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
  </head>
  <body>

    <canvas id="myChart"></canvas>

    <!-- ライブラリを読み込む(chart.js) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0"></script>
    
    <script>

      let data;
      var ctx = document.getElementById('myChart').getContext('2d');
      var chart = new Chart(ctx, {
	  type: 'line',
	  data: {
	      datasets: [{
		  label:"user1",
		  borderColor: "rgba(255,0,0,1)",
		  backgroundColor:"rgba(255,0,0,0)",
		  data: [],
	      },{
		  label:"user2",
		  borderColor: "rgba(0,255,0,1)",
		  backgroundColor:"rgba(0,255,0,0)",
		  data: [],
	      },{
		  label:"user3",
		  borderColor: "rgba(0,0,255,1)",
		  backgroundColor:"rgba(0,0,255,0)",
		  data: [],
	      }]
	  },
	  options: {
	      scales: {
		  x: {
		      type: 'realtime',
		      realtime: {
			  duration: 20000,  // 過去20000ミリ秒のデータを表示
			  refresh: 1000,    // onRefresh コールバックを1000ミリ秒毎に呼び出し
			  delay: 1000,      // 1000ミリ秒の遅延により、次の値が確定し線が完全に引けてから表示
			  pause: false,     // チャートは一時停止していない
			  ttl: undefined,   // データはチャートから消えると自動的に削除
			  frameRate: 30,    // データポイントを毎秒30回描画

			  
			  onRefresh: chart => {
			      for(let i=0; i<3; i++) {
				  getLatestData();
				  chart.data.datasets[i].data.push(data);
			      }
			  }
		      }
		  }
	      }
	  }
      });
      
      function getLatestData() {
	  data = {
	      x: Date.now(),
              y: Math.random()
	  }
      }
    </script>
  </body>
</html>
